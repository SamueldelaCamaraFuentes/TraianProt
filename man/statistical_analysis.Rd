% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/functions.R
\name{statistical_analysis}
\alias{statistical_analysis}
\title{Limma function for statistical analysis}
\usage{
statistical_analysis(
  df,
  test,
  paired = FALSE,
  metadata,
  logfc,
  sig,
  adjval,
  statval,
  unique_proteins,
  way,
  psms,
  platform,
  selected_conditions,
  diann_dir = NULL
)
}
\arguments{
\item{df}{The primary data frame containing expression data (rows=proteins,
cols=samples). Must also contain 'Protein' and 'Protein_description' columns.}

\item{test}{Numeric. The statistical test to use: \code{1} for \code{t.test}, \code{2} for
\code{limma}, \code{3} for \code{wilcox.test}.}

\item{paired}{Logical. \code{TRUE} if the experimental design is paired, \code{FALSE}
otherwise.}

\item{metadata}{A data frame with sample metadata. Must contain \code{group}
(condition) and \code{log2_col} (sample names matching \code{df} colnames).}

\item{logfc}{Numeric. The log-fold change (LFC) threshold for
'Up-regulated' and 'Down-regulated' status.}

\item{sig}{Numeric. The significance threshold (e.g., 0.05) to be used with
\code{statval}.}

\item{adjval}{String. The p-value adjustment method for \code{p.adjust}
(e.g., "BH").}

\item{statval}{Numeric. Which p-value to use for significance: \code{1} for raw
p-value, \code{2} for adjusted p-value.}

\item{unique_proteins}{A list with two elements containing proteins unique to
the control (\verb{[1]}) and treatment (\verb{[2]}) groups. Used only if \code{way = 2}.}

\item{way}{Numeric. \code{1} to analyze only shared proteins, \code{2} to include
unique proteins from \code{unique_proteins}.}

\item{psms}{Logical. If \code{test = 2} (limma), \code{TRUE} to use \code{DEqMS} for
spectral count weighting.}

\item{platform}{Numeric. Used if \code{psms = TRUE}. Specifies data source for
finding PSM columns: \code{1}=MaxQuant, \code{2}=MSFragger, \code{4}=Proteome Discoverer.}

\item{selected_conditions}{A character vector of length 2.
\code{selected_conditions[2]} is treated as the control group, and
\code{selected_conditions[1]} as the treatment group.}

\item{diann_dir}{String. Directory path for DIA-NN. \strong{Note:} This parameter
is currently not implemented in the function body.}
}
\value{
A data frame (\code{results.eb}) with DE results, including \code{logFC},
\code{p.value}, \code{adj.P.Val}, \code{expression}, \code{Protein}, and
\code{Protein_description}. Additional columns may be present for \code{limma}/\code{DEqMS}
(e.g., \code{sca.P.Value}).
}
\description{
A comprehensive function to perform differential expression (DE) analysis
between two conditions. It supports t-tests, Wilcoxon tests, and \code{limma},
with options for paired data and \code{DEqMS} spectral count weighting.
}
\details{
Perform Differential Expression Statistical Analysis

This function acts as a wrapper for various statistical tests. The \code{logFC} is
calculated as \code{mean(treatment) - mean(control)}.

When \code{way = 2}, unique proteins are added to the results with imputed \code{logFC}
and p-values (e.g., p-value = min(p.value)/100) to ensure they appear in
visualizations.

The function uses several non-standard variable assignment methods
(e.g., \code{assign}, \code{ls}, \code{get}) to dynamically create sample groups.
}
\examples{
# 1. Create a mock data frame (df)
set.seed(123)
df_data <- data.frame(
  Protein = paste0("Prot", 1:5),
  Protein_description = paste("Description for", paste0("Prot", 1:5)),
  Cond1_R1 = rnorm(5, 10, 1),
  Cond1_R2 = rnorm(5, 10, 1),
  Cond2_R1 = rnorm(5, 12, 1), # Cond2 is higher
  Cond2_R2 = rnorm(5, 12, 1)
)
rownames(df_data) <- df_data$Protein

# 2. Create mock metadata
meta <- data.frame(
  log2_col = c("Cond1_R1", "Cond1_R2", "Cond2_R1", "Cond2_R2"),
  group = c("Condition1", "Condition1", "Condition2", "Condition2")
)

# 3. Define unique proteins (for way = 2)
uniques_list <- list(
  data.frame(Protein = "Prot_Control", Protein_description = "Only in Control"),
  data.frame(Protein = "Prot_Treat", Protein_description = "Only in Treatment")
)

# Run analysis (t-test, unpaired, no PSMs, include uniques)
results <- statistical_analysis(
  df = df_data,
  test = 1, # t-test
  paired = FALSE,
  metadata = meta,
  logfc = 1,
  sig = 0.05,
  adjval = "BH",
  statval = 2, # Use adjusted p-value
  unique_proteins = uniques_list,
  way = 2, # Include uniques
  psms = FALSE,
  platform = 1,
  selected_conditions = c("Condition2", "Condition1") # Treat 2 vs 1
)

print(results)


}
